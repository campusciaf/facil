<app-menu></app-menu>
<div id="content">
    <div class="row mx-0 px-0 content">
        <div class="col-12 px-4 py-2">
            <div class="row mb-2">
                <div class="col-xl-6 col-9">
                    <h2 class="lh-16">
                        <span class="fs-18 text-semibold ">Gesti√≥n</span><br>
                        <span class="fs-14 fw-light">Provedores</span>
                    </h2>
                </div>
                <div class="col-xl-6 col-3 pr-4 text-end">
                    <button class="btn btn-sm btn-outline-warning px-2 py-0" ><i class="fa-solid fa-play" aria-hidden="true"></i> Tour</button>
                </div>
            </div>
        
            <div class="row">
                <div class="col-12 card-header px-4 rounded-top">
                    <div class="row">
                        <div class="col-auto pt-2">
                            <i class="pi pi-user fs-28 color-2"></i>
                
                        </div>
                        <div class="col-auto align-self-center">
                            <h6 class="fw-normal mb-0 fs-18 color-2">Proveedores</h6>
                            <p class="text-secondary small">en plataforma</p>
                        </div>
                        <div class="col-auto ms-auto">
                            <button type="button" class="btn btn-success btn-sm" (click)="open(content)"> <i class="fa-solid fa-plus"></i> Nuevo proveedor</button>
                        </div>
                    </div>
                </div>


                <div class="col-12 p-0">
                    <p-table 
                        #dt1
                        [value]="listaProveedores" 
                        [paginator]="true"
                        [rows]="10"
                        [showCurrentPageReport]="true"
                        [tableStyle]="{ 'min-width': '50rem' }"
                        currentPageReportTemplate="Mostrando {first} de {last} de {totalRecords} entradas"
                        [rowsPerPageOptions]="[10, 20, 30]"
                        [loading]="loading"
                        [globalFilterFields]="['id_proveedor', 'proveedor_nombre', 'proveedor_estado']"
                        styleClass="p-datatable-gridlines small"
                        >
                        <ng-template pTemplate="caption">
                            <div class="row">
                                <div class="col-xl-6 col-lg-6 col-md-2 col-2">
                                    <button type="button" pButton pRipple icon="pi pi-file-excel" (click)="exportExcel()" class="p-button-success mr-2" pTooltip="XLS" tooltipPosition="bottom"></button>

                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-10 col-10 text-end">
                                    
                                    <span class="p-input-icon-left ml-auto">
                                        
                                        <input pInputText type="text" (input)="dt1.filterGlobal($any($event.target).value, 'contains')" placeholder="Buscar" />
                                    </span>
                                </div>
                            </div>
                        </ng-template>
                        <ng-template pTemplate="header">
                            <tr>
                                <th pSortableColumn="id_proveedor" style="width:20%">Opciones<p-sortIcon field="id_proveedor"></p-sortIcon></th>
                                <th pSortableColumn="proveedor_nombre">Proveedor<p-sortIcon field="proveedor_nombre"></p-sortIcon></th>
                                <th>Logo</th>
                                <th pSortableColumn="proveedor_estado">Estado<p-sortIcon field="proveedor_estado"></p-sortIcon></th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-proveedor>
                            <tr>
                                <td>
                                    <a class="btn btn-warning btn-sm" title="Editar proveedor" (click)="open2(content2,proveedor.id_proveedor)"><i class="pi pi-user-edit fs-12"></i>Editar</a> 
                                
                                </td>
                                <td>{{ proveedor.proveedor_nombre }}</td>
                                <td><img src="{{proveedor.proveedor_imagen}}" width="30px"></td>
                                <td *ngIf="proveedor.proveedor_estado==1; else cargando">
                                    Activo
                                </td>
                                <ng-template #cargando>
                                <td>Bloqueado</td> 
                                </ng-template>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="paginatorleft">
                            <p-button type="button" icon="pi pi-cloud" styleClass="p-button-text"></p-button>
                        </ng-template>
                    </p-table>
                </div>

            </div>
        </div>
    </div>
</div>

<ng-template #content let-c="close" let-d="dismiss" id="closebutton" #closebutton>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Nuevo proveedor</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
    </div>
    <div class="modal-body">
        <div class="row align-items-center justify-content-center">
            <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-xxl-12 text-center">    
      
                <form class="row mb-4 text-start"  [formGroup]="formproveedores" (ngSubmit)="registro()">

                    <!-- alert messages -->
                    <div class="col-12">
                        <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                            <div class="input-group input-group-lg">
                                <span class="input-group-text text-theme "><i class="pi pi-shop"></i></span>
                                <div class="form-floating">
                                    <input class="form-control border-start-0" placeholder="Proveedor" autofocus="" type="text" name="proveedor_nombre" formControlName="proveedor_nombre" required >
                                    <label>Nombre del proveedor</label>
                                </div>
                            </div>
                        </div>
                    </div>
                  
                    <div class="col-12">
                        <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                            <div class="input-group input-group-lg ">
                                <span class="input-group-text text-theme "><i class="pi pi-images"></i></span>
                                <div class="form-floating">
                                    <input class="form-control  border-start-0" placeholder="" type="file" formControlName="proveedor_imagen" accept="image/*" (change)="seleccionarArchivo($event)">
                                    <label>cargar imagen</label>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    <div *ngIf="previsualizacion" class="py-2"><img [src]="previsualizacion" alt="" width="150px"></div>

                    <div class="col-12">
                        <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                            <div class="input-group input-group-lg">
                                <span class="input-group-text text-theme "><i class="pi pi-unlock"></i></span>
                                <div class="form-floating">
                                    <select class="form-select  border-start-0" name="proveedor_estado" formControlName="proveedor_estado">
                                        <option value="1" select>Activo</option>  
                                        <option value="0">Inactivo</option>  
                                    </select>
                                    <label for="lugartrabajo">Estado del proveedor</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-success" type="submit" ><i class="fa-solid fa-arrow-right"></i> Crear Proveedor</button>
                    <div class="invalid-feedback" style="display: none;">Add .com at last to insert valid data </div>
                </form>
      
      
            </div>
        </div>
    </div>
</ng-template>

<ng-template #content2 let-c="close" let-d="dismiss" id="closebutton" #closebutton>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Editar proveedor</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
    </div>
    <div class="modal-body">
        <div class="row align-items-center justify-content-center">
            <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-xxl-12 text-center">    
      
                <form class="row mb-4 text-start"  [formGroup]="formProveedoresEditar" (ngSubmit)="editar()">

                <input class="form-control border-start-0"  type="text" autofocus="" name="id_proveedor_e" formControlName="id_proveedor_e" *ngIf="mostrar">

                    <!-- alert messages -->
                    <div class="col-12">
                        <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                            <div class="input-group input-group-lg">
                                <span class="input-group-text text-theme "><i class="pi pi-shop"></i></span>
                                <div class="form-floating">
                                    <input class="form-control border-start-0" placeholder="Proveedor" autofocus="" type="text" name="proveedor_nombre_e" formControlName="proveedor_nombre_e" required >
                                    <label>Nombre del proveedor</label>
                                </div>
                            </div>
                        </div>
                    </div>
                  
                    <div class="col-12">
                        <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                            <div class="input-group input-group-lg ">
                                <span class="input-group-text text-theme "><i class="pi pi-images"></i></span>
                                <div class="form-floating">
                                    <input class="form-control  border-start-0" placeholder="" type="file" id="proveedor_imagen_e" formControlName="proveedor_imagen_e" accept="image/*" (change)="seleccionarArchivo($event)">
                                    <label>cargar imagen</label>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    <div *ngIf="previsualizacion" class="py-2"><img [src]="previsualizacion" alt="" width="150px"></div>

                    <div class="col-12">
                        <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                            <div class="input-group input-group-lg">
                                <span class="input-group-text text-theme "><i class="pi pi-unlock"></i></span>
                                <div class="form-floating">
                                    <select class="form-select  border-start-0" name="proveedor_estado_e" formControlName="proveedor_estado_e">
                                        <option value="1" select>Activo</option>  
                                        <option value="0">Inactivo</option>  
                                    </select>
                                    <label for="lugartrabajo">Estado del proveedor</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-success" type="submit" ><i class="fa-solid fa-arrow-right"></i> Editar Proveedor</button>
                    <div class="invalid-feedback" style="display: none;">Add .com at last to insert valid data </div>
                </form>
      
      
            </div>
        </div>
    </div>
</ng-template>