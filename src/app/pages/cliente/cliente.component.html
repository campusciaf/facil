<app-menu></app-menu>
<div id="content">
    <div class="row mx-0 px-0 content">
        <div class="col-12 px-4 py-2">
            <div class="row mb-2">
                <div class="col-xl-6 col-9">
                    <h2 class="lh-16">
                        <span class="fs-18 text-semibold color-2">Gestión</span><br>
                        <span class="fs-14 fw-light">CLientes</span>
                    </h2>
                </div>
                <div class="col-xl-6 col-3 pr-4 text-end">
                    <button class="btn btn-sm btn-outline-warning px-2 py-0" ><i class="fa-solid fa-play" aria-hidden="true"></i> Tour</button>
                </div>
            </div>

     
        
            <div class="row">
                <div class="col-12 card-header px-4 rounded-top">
                    <div class="row">
                        <div class="col-auto pt-2">
                            <i class="pi pi-user fs-28 color-2"></i>
                
                        </div>
                        <div class="col-auto align-self-center">
                            <h6 class="fw-normal mb-0 fs-18 color-2">Clientes</h6>
                            <p class="text-secondary small ">en plataforma</p>
                        </div>
                        <div class="col-auto ms-auto">
                            <button type="button" class="btn btn-success btn-sm" (click)="open(content)"> <i class="fa-solid fa-plus"></i> Nuevo cliente</button>
                        </div>
                    </div>
                </div>
                <div class="col-12 p-0">
                    <p-table 
                        #dt1
                        [value]="listaClientes" 
                        [paginator]="true"
                        [rows]="10"
                        [showCurrentPageReport]="true"
                        [tableStyle]="{ 'min-width': '50rem' }"
                        currentPageReportTemplate="Mostrando {first} de {last} de {totalRecords} entradas"
                        [rowsPerPageOptions]="[10, 20, 30]"
                        [loading]="loading"
                        [globalFilterFields]="['id_cliente', 'cliente_nombre', 'cliente_estado']"
                        styleClass="p-datatable-gridlines small"

                        >
                        <ng-template pTemplate="caption">
                            <div class="row">
                                <div class="col-xl-6 col-lg-6 col-md-2 col-2">
                                    <button type="button" pButton pRipple icon="pi pi-file-excel" (click)="exportExcel()" class="p-button-success mr-2" pTooltip="XLS" tooltipPosition="bottom"></button>

                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-10 col-10 text-end">
                                    
                                    <span class="p-input-icon-left ml-auto">
                                        
                                        <input pInputText type="text" (input)="dt1.filterGlobal($any($event.target).value, 'contains')" placeholder="Buscar" />
                                    </span>
                                </div>
                            </div>
                        </ng-template>
                        <ng-template pTemplate="header">
                            <tr>
                                <th pSortableColumn="id_cliente" style="min-width: 150px">Opciones<p-sortIcon field="id_cliente"></p-sortIcon></th>
                                <th>Identificación</th>
                                <th pSortableColumn="cliente_nombre">Cliente<p-sortIcon field="cliente_nombre"></p-sortIcon></th>
                                <th>Celular</th>
                                <th>Correo</th>
                                <th pSortableColumn="cliente_estado">Estado<p-sortIcon field="cliente_estado"></p-sortIcon></th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-datos>
                            <tr>
                                <td>
                                    <a class="btn btn-warning btn-sm" title="Editar cliente" (click)="open2(content2,datos.id_cliente)"><i class="pi pi-user-edit fs-12"></i></a> 
                                <a class="btn btn-danger btn-sm" (click)="open3(content3,datos.id_cliente)"><i class="pi pi-map-marker"></i> Mapa</a>
                                
                                </td>
                                <td>{{datos.cliente_identificacion}}</td>
                                <td>{{ datos.cliente_nombre }}</td>
                                <td>{{ datos.cliente_celular }}</td>
                                <td>{{ datos.cliente_email }}</td>
                                <td *ngIf="datos.cliente_estado==1; else cargando">
                                    Activo
                                </td>
                                <ng-template #cargando>
                                <td>Bloqueado</td> 
                                </ng-template>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="paginatorleft">
                            <p-button type="button" icon="pi pi-cloud" styleClass="p-button-text"></p-button>
                        </ng-template>
                    </p-table>
                </div>

            </div>
        </div>
    </div>
</div>

<ng-template #content let-c="close" let-d="dismiss" id="closebutton" #closebutton>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Nuevo cliente</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
    </div>
    <div class="modal-body">
        <div class="row align-items-center justify-content-center">
            <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-xxl-12 text-center">    
      
                <form class="row mb-4 text-start"  [formGroup]="formclientes" (ngSubmit)="registro()">



                    <!-- alert messages -->
                    <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                      <div class="input-group input-group-lg">
                          <span class="input-group-text text-theme "><i class="pi pi-user"></i></span>
                          <div class="form-floating">
                              <input class="form-control border-start-0" placeholder="CLiente" autofocus="" type="text" name="cliente_nombre" formControlName="cliente_nombre" required >
                              <label>Nombre cliente</label>
                          </div>
                      </div>
                  </div>

                  <div *ngFor="let validation of account_validation_messages.nombre_acudiente">
                    <div class="error-message" *ngIf="formclientes.get('cliente_nombre')?.hasError(validation.type) && (formclientes.get('cliente_nombre')?.dirty || formclientes.get('cliente_nombre')?.touched)">{{validation.message}}
                    </div>
                </div>


                <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                    <div class="input-group input-group-lg">
                        <span class="input-group-text text-theme "><i class="pi pi-code"></i></span>
                        <div class="form-floating">
                            <input class="form-control border-start-0" placeholder="Identificacion" autofocus="" type="text" name="cliente_identificacion" formControlName="cliente_identificacion">
                            <label>Identificación</label>
                        </div>
                    </div>
                </div>

                <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                    <div class="input-group input-group-lg">
                        <span class="input-group-text text-theme "><i class="pi pi-mobile"></i></span>
                        <div class="form-floating">
                            <input class="form-control border-start-0" placeholder="Celular" autofocus="" type="text" name="cliente_celular" formControlName="cliente_celular">
                            <label>Número celular</label>
                        </div>
                    </div>
                </div>

                <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                    <div class="input-group input-group-lg">
                        <span class="input-group-text text-theme "><i class="pi pi-envelope"></i></span>
                        <div class="form-floating">
                            <input class="form-control border-start-0" placeholder="Correo" autofocus="" type="text" name="cliente_email" formControlName="cliente_email">
                            <label>Correo electronico</label>
                        </div>
                    </div>
                </div>

                <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                    <div class="input-group input-group-lg">
                        <span class="input-group-text text-theme "><i class="pi pi-map-marker"></i></span>
                        <div class="form-floating">
                            <input class="form-control border-start-0" placeholder="Dirección" autofocus="" type="text" name="cliente_direccion" formControlName="cliente_direccion">
                            <label>Direccción</label>
                        </div>
                    </div>
                </div>

                <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                    <div class="input-group input-group-lg">
                        <span class="input-group-text text-theme "><i class="pi pi-lock
                            "></i></span>
                        <div class="form-floating">
                            <select class="form-select border-start-0 " name="cliente_estado" formControlName="cliente_estado">
                                <option value="1" selected>Activo</option>  
                                <option value="0">Inactivo</option>  
                            </select>
                            <label>Estado cliente</label>
                        </div>
                    </div>
                </div>

                    <button class="btn btn-success" type="submit" [disabled]="!formclientes.valid"><i class="fa-solid fa-arrow-right"></i> Crear cliente</button>
                    <div class="invalid-feedback" style="display: none;">Add .com at last to insert valid data </div>
                </form>
      
      
            </div>
        </div>
    </div>
</ng-template>


<ng-template #content2 let-c="close" let-d="dismiss" id="closebutton" #closebutton>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Editar cliente</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
    </div>
    <div class="modal-body">
        <div class="row align-items-center justify-content-center">
            <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-xxl-12 text-center">    
      
                <form class="row mb-4 text-start"  [formGroup]="formClientesEditar" (ngSubmit)="editar()">

                    <input class="form-control border-start-0"  type="text" autofocus="" name="id_cliente_e" formControlName="id_cliente_e" *ngIf="mostrar">

                    <!-- alert messages -->
                    <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text text-theme "><i class="pi pi-user"></i></span>
                            <div class="form-floating">
                                <input class="form-control border-start-0" placeholder="CLiente"  type="text" name="cliente_nombre_e" formControlName="cliente_nombre_e" required >
                                <label>Nombre cliente</label>
                            </div>
                        </div>
                    </div>

                    <div *ngFor="let validation of account_validation_messages.nombre_acudiente">
                        <div class="error-message" *ngIf="formClientesEditar.get('cliente_nombre_e')?.hasError(validation.type) && (formClientesEditar.get('cliente_nombre_e')?.dirty || formClientesEditar.get('cliente_nombre_e')?.touched)">{{validation.message}}
                        </div>
                    </div>
                    
                    
                    <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text text-theme "><i class="pi pi-code"></i></span>
                            <div class="form-floating">
                                <input class="form-control border-start-0" placeholder="Identificacion" autofocus="" type="text" name="cliente_identificacion_e" formControlName="cliente_identificacion_e">
                                <label>Identificación</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text text-theme "><i class="pi pi-map-marker"></i></span>
                            <div class="form-floating">
                                <input class="form-control border-start-0" placeholder="Celular" autofocus="" type="text" name="cliente_municipio_e" formControlName="cliente_municipio_e">
                                <label>Municipio Residencia</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text text-theme "><i class="pi pi-map"></i></span>
                            <div class="form-floating">
                                <input class="form-control border-start-0" placeholder="Celular" autofocus="" type="text" name="cliente_direccion_e" formControlName="cliente_direccion_e">
                                <label>Dirección residencia</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text text-theme "><i class="pi pi-map"></i></span>
                            <div class="form-floating">
                                <input class="form-control border-start-0" placeholder="Celular" autofocus="" type="text" name="cliente_barrio_e" formControlName="cliente_barrio_e">
                                <label>Barrio residencia</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text text-theme "><i class="pi pi-mobile"></i></span>
                            <div class="form-floating">
                                <input class="form-control border-start-0" placeholder="Celular" autofocus="" type="text" name="cliente_celular_e" formControlName="cliente_celular_e">
                                <label>Número celular</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text text-theme "><i class="pi pi-envelope"></i></span>
                            <div class="form-floating">
                                <input class="form-control border-start-0" placeholder="Correo" autofocus="" type="text" name="cliente_email_e" formControlName="cliente_email_e">
                                <label>Correo electronico</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3 position-relative check-valid is-valid mx-0 px-0">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text text-theme "><i class="pi pi-lock
                                "></i></span>
                            <div class="form-floating">
                                <select class="form-select border-start-0 " name="cliente_estado_e" formControlName="cliente_estado_e">
                                    <option value="1" selected>Activo</option>  
                                    <option value="0">Inactivo</option>  
                                </select>
                                <label>Estado cliente</label>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-success" type="submit" [disabled]="!formClientesEditar.valid"><i class="fa-solid fa-arrow-right"></i> Actualizar cliente</button>
                    <div class="invalid-feedback" style="display: none;">Add .com at last to insert valid data </div>
                </form>
      
      
            </div>
        </div>
    </div>
</ng-template>


<ng-template #content3 let-c="close" let-d="dismiss" id="closebutton" #closebutton>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Editar cliente</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
    </div>
    <div class="modal-body">
        <div class="row align-items-center justify-content-center">
            <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-xxl-12 text-center text-white">    
      
                <div class="map-container">
                    <google-map height="500px" width="100%" [center]="center" [zoom]="zoom" (mapClick)="mapClicked($event)">
                      <map-marker
                        #marker="mapMarker"
                        [position]="markerPosition"
                        [options]="markerOptions"
                        (mapDragend)="markerDragEnd($event)">
                      </map-marker>
                    </google-map>
                </div>
                <div class="d-grid gap-2">
                        <a (click)="guardarUbicacion()" class="btn btn-success"> Guardar Ubicación</a>
                </div>
            </div>
        </div>
    </div>
</ng-template>
